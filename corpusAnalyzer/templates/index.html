<!--
	Author: W3layouts
	Author URL: http://w3layouts.com
	License: Creative Commons Attribution 3.0 Unported
	License URL: http://creativecommons.org/licenses/by/3.0/
-->
{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>File Upload widget a Flat Responsive Widget Template :: w3layouts</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link href='//fonts.googleapis.com/css?family=Open+Sans:400,300italic,300,400italic,600,600italic,700,700italic,800,800italic'
          rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>


    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="keywords"
          content="File Upload widget Widget Responsive, Login Form Web Template, Flat Pricing Tables, Flat Drop-Downs, Sign-Up Web Templates, Flat Web Templates, Login Sign-up Responsive Web Template, Smartphone Compatible Web Template, Free Web Designs for Nokia, Samsung, LG, Sony Ericsson, Motorola Web Design"/>

    <script type="text/javascript" src="{% static 'js/jquery.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/bootbox.min.js' %}"></script>
    <script src="{% static 'js/FileSaver.js' %}"></script>
    <script src="{% static 'js/filedrag.js' %}"></script>
    <script type="application/x-javascript"> addEventListener("load", function () {
        setTimeout(hideURLbar, 0);
    }, false);

    function hideURLbar() {
        window.scrollTo(0, 1);
    } </script>
</head>

<body>
<h1>Add your files here</h1>
<div class="agile-its">
    <h2>File Upload</h2>
    <div class="w3layouts">
        <p>You can drag & drop files from your desktop on this webpage.</p>
        <div class="photos-upload-view">
            <form id="upload" action="" method="POST" enctype="multipart/form-data">
                <input type="hidden" id="MAX_FILE_SIZE" name="MAX_FILE_SIZE" value="300000"/>
                <div class="agileinfo">
                    <input type="submit" class="choose" value="Choose file..">
                    <h3>OR</h3>
                    <input type="file" id="fileselect" name="selected_files" multiple="multiple"/>
                    <div id="filedrag">drag and drop files here</div>
                </div>
            </form>
            <div id="messages">
                <p>Status Messages</p>
            </div>
            <button class="btnquery" onclick="send_file_to_backend()">click here to extract terms</button>
        </div>
        <div class="clearfix"></div>


    </div>
</div>
<div class="footer">
    <p> Â© 2016 File Upload widget. All Rights Reserved | Design by <a href="http://w3layouts.com/"> W3layouts</a></p>
</div>

<script>
    var plain_text_data

    function add_download_button() {
        let download_button = document.createElement("button");
        download_button.id = "technical_term_download_btn"
        download_button.innerHTML = "download technical terms here"
        download_button.addEventListener("click", function () {
            var blob = new Blob([plain_text_data], {
                type: "text/plain;charset=utf-8"
            });
            saveAs(blob, "extracted_terms.txt")
        })
        let appeared_div = document.getElementsByClassName("photos-upload-view")[0]
        appeared_div.append(download_button)
    }

    function send_file_to_backend() {
        let formdata = new FormData($('#upload')[0])
        console.log(formdata)
        console.log(formdata.entries())
        $.ajax({
            type: "POST",
            cache: false,
            url: "ajax/handle_extract_file_term/12138",
            data: formdata,
            processData: false,
            contentType: false,
            async: true,
            timeout: 500000,
            beforeSend: function (xhr, setting) {
                xhr.setRequestHeader("X-CSRFToken", "{{csrf_token}}")
            },

            error: function () {
                bootbox.confirm("extraction failed, please check if files are valid", function () {
                    location.reload()
                })
            },
            success: function (result_text) {
                add_download_button()
                plain_text_data = result_text
                console.log(result_text)
                if (result_text !== "failed") {
                    bootbox.alert({
                        title: "extraction succeed!",
                        message:
                            "<p>click technical term download button to download resulting technical terms</p>",
                        callback: function () {
                            {#location.reload()#}
                        },
                    })
                } else {
                    bootbox.confirm({
                        title: "extraction failed!",
                        message:
                            "<p>internal server error, please try again later</p>",
                        callback: function () {
                            {#location.reload()#}
                        },
                    })
                }
            }
        })
    }
</script>
</body>
</html>